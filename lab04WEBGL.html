<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"></meta>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"></meta>
<title>WebGL - 2D Image</title>
<link type="text/css" href="resources/webgl-tutorials.css" rel="stylesheet" />
</head>
<body>

<canvas id="canvas" width="400" height="300"></canvas>
<script type="vertex">
  attribute vec2 a_pos;
  varying vec2 v_pos;
  void main() {
      v_pos = vec2(a_pos.xy);
      gl_Position = vec4(a_pos, 0, 1);
  }
</script>
<script type="fragment">
  precision highp float;
  varying vec2 v_pos;
  void main() {
    gl_FragColor = vec4(v_pos, 0.0, 1.0);
  }
</script>
<script>
  var canvas = document.getElementById("canvas");
  var gl = canvas.getContext('experimental-webgl');
  if (!gl) throw 'webgl сломался';

  try {
    var program = gl.createProgram();

    // вершинный шейдер: сопоставление пикселей, установка gl_Position в качестве vec4
    var vertShaderObj = gl.createShader(gl.VERTEX_SHADER);
    var vertexShaderSrc = document.querySelector('[type="vertex"]').textContent;
    gl.shaderSource(vertShaderObj, vertexShaderSrc);
    gl.compileShader(vertShaderObj);
    gl.attachShader(program, vertShaderObj);

    // фрагментный шейдер: раскраска пикселей, установка gl_FragColor в качестве vec4
    var fragShaderObj = gl.createShader(gl.FRAGMENT_SHADER);
    var fragmentShaderSrc = document.querySelector('[type="fragment"]').textContent;
    gl.shaderSource(fragShaderObj, fragmentShaderSrc);
    gl.compileShader(fragShaderObj);
    gl.attachShader(program, fragShaderObj);

    gl.linkProgram(program);
    gl.useProgram(program);
    if (!gl.getShaderParameter(vertShaderObj, gl.COMPILE_STATUS)) throw new Error("Could not compile shader: " + gl.getShaderInfoLog(vertShaderObj));
    if (!gl.getShaderParameter(fragShaderObj, gl.COMPILE_STATUS)) throw new Error("Could not compile shader: " + gl.getShaderInfoLog(fragShaderObj));
  } catch(e) {
    console.error(e && e.stack || e);
  }

  var positionLocation = gl.getAttribLocation(program, "a_pos");

  var buffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
    // прямоугольники
    -1.0, -1.0,
    1.0, -1.0,
    -1.0, 1.0,

    -1.0, 1.0,
    1.0, -1.0,
    1.0, 1.0]), gl.STATIC_DRAW);
  gl.enableVertexAttribArray(positionLocation);
  gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

  // рисование
  gl.drawArrays(gl.TRIANGLES, 0, 6);
</script>

</body>
  <div id="info-div">
    Градиент серого.
  </div>
</footer>

</html>


